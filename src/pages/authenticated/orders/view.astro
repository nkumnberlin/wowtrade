---
import resolveCookie from "../../../../utils/resolveCookie"
import { deleteOrder } from "../../../external/services/Order"
import Layout from "../../../components/global/Layout/Layout.astro"
import { ViewOrder } from "../../../features/orders/view/public"
import OrdersToAccount from "../../../features/orders/view/auth"
import {
	getLast5Orders,
	getOrdersToUser
} from "../../../external/services/Order"
let ordersToUser
try {
	const cookie = resolveCookie(Astro.cookies.get("wow-trade-session").value)
	ordersToUser = await getOrdersToUser({ cookie })

	const id = Astro.url.searchParams.get("id")
	if (id !== null) {
		const isSuccessful = await deleteOrder({ cookie, id_crafted_item: id })
		if (isSuccessful.status === 201) {
			ordersToUser = await getOrdersToUser({ cookie })
		}
	}
} catch (e) {
	console.log("error while fetching data")
}
---

<Layout title="See Listing">
	<div>
		Your Orders:
		<OrdersToAccount orders={ordersToUser} />
	</div>
</Layout>

<script>
	// const buttons = window.document.querySelectorAll("button")
	// const selectItemToDelete = (ev) => {
	// 	const url = new URL(window.location.href)
	// 	url.searchParams.set("id", ev.target.id)
	// 	window.location.href = url.href
	// }
	// buttons.forEach((button) =>
	// 	button.addEventListener("click", selectItemToDelete)
	// )
</script>
