---
import resolveCookie from "../../../../../../../../utils/resolveCookie"
import {
	getUsersCharactersList,
	getUserProfessionsToCharacter
} from "@/character"
import Layout from "../../../../../../../components/global/Layout/Layout.astro"
import Characters from "../../../../../../../features/characters"
import Professions from "../../../../../../../features/professions"
const { server, name } = Astro.params
const cookie = resolveCookie(Astro.cookies.get("wow-trade-session").value)
// global abgespeichert werden ? view reused from previous render? :thinking:
let characters, professions
try {
	characters = await getUsersCharactersList(cookie)
	professions = await getUserProfessionsToCharacter(cookie, name, server)
} catch (e) {
	console.log("fetch failed", e)
}
---

<!-- WoWHead -->
<script id="header" is:inline>
	{
		;("const whTooltips = {colorLinks: true, iconizeLinks: true, renameLinks: true}")
	}
</script>
<script
	id="headerscript"
	src="https://wow.zamimg.com/widgets/power.js"
	strategy="lazyOnload"
	is:inline
></script>

<Layout title="Authenticate your Account">
	<div class="flex flex-row">
		<div class="basis-1/3">
			<Characters characters={characters} />
		</div>
		<div class="basis-2/3">
			<Professions
				professionToCharacter={professions}
				qualifiedCharacterName={`${name}-${server}`}
				client:only="react"
			/>
		</div>
	</div>
</Layout>

<script client:load src="../../../../handleSelectCharacter.ts"></script>
